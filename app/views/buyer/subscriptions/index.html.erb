<h1 class='text-center text-info my-4'> Your Subscriptions </h1>
<ul class='list-group'>
  <% @subscriptions.each do |subscription| %>
    <li class='list-group-item'>
      <strong class='text-primary'>Subscription Name: </strong>
      <%= subscription.subscription_name %>
    </li>
    <li class='list-group-item'>
      <strong class='text-primary'>Price: </strong> <%= subscription.price %>$
    </li>
    <li class='list-group-item'>
      <%= link_to 'Unsubscribe', buyer_subscription_path(subscription), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
    </li>
    <% subscription.plan.feature_plans.each do |feature_plan| %>
      <li class='list-group-item'>
        <strong class='text-primary'>Feature Name: </strong>
        <%= feature_plan.feature.feature_name %>
      </li>
      <li class='list-group-item'>
        <strong class='text-primary'>Unit Price: </strong> <%= feature_plan.feature.unit_price %>$
      </li>
      <li class='list-group-item'>
        <strong class='text-primary'>Max Unit Limit: </strong>
        <%= feature_plan.feature.max_unit_limit %>
      </li>
      <% consume_feature = get_consume_feature(subscription.consume_features, feature_plan.feature.id) %>
      <% if consume_feature %>
        <li class='list-group-item d-flex flex-row'>
          <strong class='text-primary '>Consumed Units: </strong>
          <div id='consume-<%= "#{feature_plan.feature.id}" %>' class ='consume ms-1' >
          <%= consume_feature.consume_units %></div>
        </li>
        <li class='list-group-item d-none message'>
          <div class='alert alert-success' role='alert'>
            Unit consumed for this feature!
          </div>
        </li>
      <% else %>
        <li class='list-group-item'>
          <strong class='text-primary'>Consumed Units: </strong> 0
        </li>
      <% end %>
      <li class='list-group-item'>
        <%= link_to 'Consume Unit', increment_consumed_unit_buyer_consume_feature_path(feature_plan.feature.id, cosume_feature: {feature_id: feature_plan.feature.id, subscription_id: subscription.id}), method: :patch, class: 'btn btn-success', remote: true %>
    <% end %>
    <hr class='border border-success border-2 mb-4'>
  <% end %>
</ul>
<div class='mb-3'>
  <% if @bill %>
    <h5 class='text-danger ms-4'> Your Bill is: <%= @bill.total_bill %>$
      <button type='button' class='btn  btn-warning my-4 ms-3' data-bs-toggle='modal' data-bs-target='#invoice'>
        View Invoice
      </button>
      <%= render 'shared/invoice' %>
    </h5>
  <% end %>
</div>
